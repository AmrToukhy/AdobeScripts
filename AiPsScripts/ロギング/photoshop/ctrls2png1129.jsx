/*    Ctrls2PNG.jsx        ctrl+sでPNG画像をpngフォルダに自動吐き出し for MacPhotoshop    version: 1.0            Author : Takahiro Isihiyama    Mail : ishiyama@sirok.co.jp        導入方法:     1:スクリプトをhogehoge.jsxとして保存    2:Applications/Adobe Photoshop CS5.1/Presets/Scripts/ に移動    3:photoshopの キーボードショートカットのCTRL+S に割り当て        !ver0.9 bugReport!    **ドキュメントを保存してないとエラーが出ますが、ドキュメント保存をしていれば正常に動きます**   */#include "ScriptListenerOn.jsx"#target photoshop//ドキュメントが開かれているかどうか判別//alert(app.documents.length);if (app.documents.length == 0);else main();/****************/function main(){    var docObj = activeDocument; //ファイル情報取得  saveFlag = docObj.saved;  //ドキュメントが保存されているかどうかを見て  if(!saveFlag){      var docPath = docObj.path; //ファイルパス    var docName = docObj.name; //ファイル名    var date = dateClass(); //現在時刻の取得    publishPng(date, docPath, docName); //PNGパブリッシュ    putLog(date, docPath, docName);//mac        docObj.save();  //上書き保存     }else docObj.save();  return;}/* fin main *///putLogfunction putLog(date, docPath, docName){    //macListenerPath  var logFile = File("~/Desktop/ScriptingListenerJS.log");  logFile.open("r");  history = logFile.read();//.split(/\/\/\s\=+/);    folderName = docPath +"\/log\/history\/";  folderObj = new Folder (folderName);  flag = folderObj.exists; //フォルダの有無  var fileRef = new File(folderName+"/"+docName.slice(0,-4)+"_"+date+".log");  fileRef.encoding = "UTF8"; //文字コードをUTF-8に  if(flag == false){   folderObj.create(); //フォルダがない場合にフォルダを作成  }	flag = fileRef.open ("w","","");	if(flag)   {        fileRef.writeln(history);	}  logFile.remove();  fileRef.close();} //現在時刻の取得function dateClass(){    //dTbl = new Array("日","月","火","水","木","金","土");  dObj = new Date();   while((new Date()).getTime() < dObj.getTime() + 1000*5){ //timeOut5秒      //日時の振り分け      year = dObj.getYear();      year2 = (year < 2000) ? year + 1900 : year;      month = dObj.getMonth() + 1;      day = dObj.getDate();      //day2 = dTbl[day];      h = dObj.getHours();      m = dObj.getMinutes();      s = dObj.getSeconds();            //alert(year2 + "年" + month +"月" + day +"日"+"("+day2+")"+ h+"時"+m+"分"+s+"秒");      //new Date()の元データを保持      dateRaw = year2+'-'+month+'-'+day+' '+h+"h"+m+"m"+s+"s";      break;  }  return dateRaw;}/* fin dateClass *///png保存function publishPng(date, docPath, docName){  folderName = docPath +"\/log\/view\/";  folderObj = new Folder (folderName);  flag = folderObj.exists; //フォルダの有無  if(flag == false){   folderObj.create(); //フォルダがない場合にフォルダを作成  }  //フォルダが存在している場合  fileName = docName.slice(0,-4) + "\_" + date;  filePath = folderName + fileName + ".png";  //alert(filePath);  fileObj = new File(filePath);  pngOpt = new PNGSaveOptions();  pngOpt.interlaced = false; //インタレースなし  activeDocument.saveAs(fileObj, pngOpt, true, Extension.LOWERCASE);}/* fin publishPng *///debugfunction alertObj(obj) {    var properties = '';    for (var prop in obj){        properties += prop + "=" + obj[prop] + "\n";    }    alert(properties);}   